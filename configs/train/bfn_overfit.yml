model:
  type: antibody_bfn
  res_feat_dim: 128
  pair_feat_dim: 96
  diffusion:
    num_steps: 20
    beta: 1.0            # BFN precision scalar
    schedule: cosine     # 'linear' or 'cosine'
    eps_net_opt:
      num_layers: 6  # Restored from 3 for more capacity
  train_structure: true
  train_sequence: true
  ot_opt:
    num_iters: 5  # Reduced Sinkhorn iterations
  loss_weight:           # Model-level loss weights for BFN core
    seq: 1.0
    ang_aux: 0.5

train:
  loss_weights:
    # Pure sequence design with auxiliary angle prediction
    seq: 1.0    # Only sequence CE loss
    ang_aux: 0.1  # Auxiliary sidechain angle loss
  max_iters: 600
  val_freq: 600
  log_freq: 20
  batch_size: 1
  # fixed_t: 0.5  # REMOVED - use random t sampling for proper BFN training
  warmup_steps: 10
  seed: 2022
  max_grad_norm: 1.0
  optimizer:
    type: adam
    lr: 1.e-3
    weight_decay: 0.0
    beta1: 0.9
    beta2: 0.999
  scheduler:
    type: plateau
    factor: 0.8
    patience: 10
    min_lr: 5.e-6

dataset:
  train:
    type: custom
    structure_dir: ./data/overfit_pdbs
    heavy_id: A
    light_id: B
    transform:
    - type: mask_single_cdr
      selection: H_CDR3
    - type: merge_chains
    - type: patch_around_anchor
  val:
    type: custom
    structure_dir: ./data/overfit_pdbs
    heavy_id: A
    light_id: B
    transform:
    - type: mask_single_cdr
      selection: H_CDR3
    - type: merge_chains
    - type: patch_around_anchor
